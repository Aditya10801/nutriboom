{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto p-4">
    <div class="flex flex-cols justify-center items-center h-screen">
      <div class="grid">
        <h1 class="text-3xl font-bold mb-4 text-center text-yellow-800" style="font-family: 'Boska', serif;">Meditation Timer</h1>
        <div class="flex flex-cols gap-10 justify-center items-center">
          <div class="mb-4">
            <label for="hours" class="block mb-2">Hours:</label>
            <input type="number" id="hours" class="px-4 py-2 border rounded w-16" min="0" value="0">
          </div>

          <div class="mb-4">
            <label for="minutes" class="block mb-2">Minutes:</label>
            <input type="number" id="minutes" class="px-4 py-2 border rounded w-16" min="0" max="59" value="5">
          </div>

          <div class="mb-4">
            <label for="seconds" class="block mb-2">Seconds:</label>
            <input type="number" id="seconds" class="px-4 py-2 border rounded w-16" min="0" max="59" value="0">
          </div>
        </div>
        <div class="flex flex-cols justify-center items-center gap-5">
          <button id="startButton" class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded-3xl"
            onclick="startMeditation()">Start Meditation</button>
          <button id="pauseButton" class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded-3xl"
            onclick="pauseMeditation()" disabled>Pause</button>
          <button id="stopButton" class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded-3xl"
            onclick="stopMeditation()" disabled>Stop</button>
        </div>
        <p id="timer" class="text-2xl mt-4 text-center"></p>
        <div class="mb-4 flex flex-cols justify-center items-center mt-5" >
         <div><p class="mb-2 text-center">Choose Background Music:</p>
          <div class="space-x-2">
            <button class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded" onclick="playMusic(0)">Lofi</button>
            <button class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded" onclick="playMusic(1)">White Noise</button>
            <button class="bg-yellow-800 hover:bg-yellow-700 text-white px-4 py-2 rounded" onclick="playMusic(2)">Yoga Music</button>
          </div>
        </div></div> 
      </div>

    </div>
  
    

  <script>
    let audioElements = [
      new Audio("lofi.mp3"),
      new Audio("white.mp3"),
      new Audio("yoga.mp3"),
    ];

    let meditationIntervalId;
    let remaining;

    function playMusic(index) {
      audioElements.forEach((audio, idx) => {
        if (index === idx) {
          audio.play();
        } else {
          audio.pause();
          audio.currentTime = 0;
        }
      });
    }

    function startMeditation() {
      let hours = parseInt(document.getElementById('hours').value);
      let minutes = parseInt(document.getElementById('minutes').value);
      let seconds = parseInt(document.getElementById('seconds').value);

      let duration = hours * 3600 + minutes * 60 + seconds;
      let timerLabel = document.getElementById('timer');
      let startButton = document.getElementById('startButton');
      let pauseButton = document.getElementById('pauseButton');
      let stopButton = document.getElementById('stopButton');

      // Disable the start button during meditation
      startButton.disabled = true;
      pauseButton.disabled = false;
      stopButton.disabled = false;

      playMusic(0); // Play the first music by default

      remaining = duration;
      meditationIntervalId = setInterval(() => {
        let hrs = Math.floor(remaining / 3600);
        let mins = Math.floor((remaining % 3600) / 60);
        let secs = remaining % 60;

        timerLabel.textContent = `Time Left: ${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

        remaining--;

        if (remaining < 0) {
          clearInterval(meditationIntervalId);
          timerLabel.textContent = "Time's up!";
          startButton.disabled = false;
          pauseButton.disabled = true;
          stopButton.disabled = true;

          // Stop all background music
          audioElements.forEach((audio) => {
            audio.pause();
            audio.currentTime = 0;
          });
        }
      }, 1000);
    }

    function pauseMeditation() {
      clearInterval(meditationIntervalId);

      let pauseButton = document.getElementById('pauseButton');
      let startButton = document.getElementById('startButton');

      pauseButton.textContent = 'Resume';
      startButton.disabled = false;
    }

    function stopMeditation() {
      clearInterval(meditationIntervalId);
      remaining = 0;

      let timerLabel = document.getElementById('timer');
      let pauseButton = document.getElementById('pauseButton');
      let stopButton = document.getElementById('stopButton');
      let startButton = document.getElementById('startButton');

      timerLabel.textContent = "Meditation Stopped";
      pauseButton.textContent = 'Pause';
      startButton.disabled = false;
      pauseButton.disabled = true;
      stopButton.disabled = true;

      // Stop all background music
      audioElements.forEach((audio) => {
        audio.pause();
        audio.currentTime = 0;
      });
    }
  </script>

{% endblock content %}